FROM --platform=linux/amd64 ubuntu:22.04
ENV LC_CTYPE C.UTF-8
ARG DEBIAN_FRONTEND=noninteractive
RUN apt-get update
# install some useful stuff
RUN apt install apt-transport-https curl gnupg -y
RUN apt-get update && apt-get install -yq gcc make wget git vim gdb clang llvm lld llvm-dev bsdmainutils libstdc++-10-dev python3 python3-pip python3-dev automake autoconf flex bison build-essential libglib2.0-dev libpixman-1-dev python3-setuptools ninja-build libtool screen
# install afl
RUN pip3 install pillow flask
# get vuln libwebp
RUN cd /root/ && git clone https://chromium.googlesource.com/webm/libwebp && cd libwebp && git checkout v1.3.1 && ./autogen.sh && ./configure && make clean all && make install
RUN cd /root/ && git clone https://github.com/emscripten-core/emsdk.git && cd emsdk && ./emsdk install latest && source /root/emsdk/emsdk_env.sh && emsdk activate latest

# setup fuzzing
ADD dump_table.c /root/dump_table.c
ADD huffman_utils.c /root/huffman_utils.c
RUN cd /root/ && gcc dump_table.c -o dump_table -I /root/libwebp/ -lwebp
ENTRYPOINT ["/pwd/init.sh"]